extends layout

block content
  h1= title
  p Welcome to #{title}

  p#dataField #{dataField} results

  script.
    var pTag = document.getElementById("dataField");

    function getData(){
      var pathname = window.location.pathname;
      fetch(pathname + "/sub")
      .then(response => response.json())
      .then(data => pTag.innerHTML = JSON.stringify(data))
    }

    function doIota(){
      var pathname = window.location.pathname;
      fetch(pathname + "/writeToIota")
      .then(response => response.text())
      .then(data => pTag.innerHTML = data)
    }

    function getIota(){
      var pathname = window.location.pathname;
      // make progress more realistic
      progress();
      fetch(pathname + "/getIotaData")
      .then(response => response.text())
      .then(data => pTag.innerHTML = data)
    }       

    function progress() {
      var current_progress = 0;
      var interval = setInterval(function() {
          current_progress += 10;
          var $ = document.getElementById.bind(document)
          $("dynamicBar").style.width = current_progress + "%"
          $("dynamicBar").ariavaluenow = current_progress
          $("dynamicBar").text = current_progress + "% Complete"
          if (current_progress >= 100)
              clearInterval(interval);
      }, 1000);
    } 

  div.body#dynamicContent
    button(type="button" name="getMyStrom" onclick="getData();") Get Panel Data
    button(type="button" name="writeToIota" onclick="doIota();") Write to Iota
    button(type="button" name="writeToIota" onclick="getIota();") Get Iota

  div.progress
    div#dynamicBar(class="progress-bar active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%")
      span#current-progress

  div.body#passwordForm
    body
      form(action='/iota/listAddresses', method='POST')
          input(type='text', name="dbname", value="", placeholder="Enter dbname")
          input(type='text', name='accountName', value='', placeholder="Enter accountName")
          input(type='submit', value='Submit')